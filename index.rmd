---
title: "Functional groups"
output:
  distill::distill_article:
    toc: true
    toc_float: true
    keep_md: yes
---

<style>
html {
  scroll-behavior: smooth;
}
d-article {
    contain: none;
  }
#TOC {
  position: fixed;
  z-index: 20;
  background: #ebebeb;     /* or   background: white; */
  padding: 10px;           /* optional */
  border-radius: 5px;      /* optional */
  }

/* Hide the ToC when resized to mobile or tablet:  480px, 768px, 900px */
@media screen and (max-width: 900px) {
#TOC {
    position: relative;
  }
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = F, error=F, message = F)
options(repos = BiocManager::repositories())
pacman::p_load('dplyr', 'tidyr', 'htmltools', 'bbplot', 'scales',
               'ggplot2', 'rdrop2', 'shiny', 'BiocManager',
               'dendextend', 'data.table', 'Biostrings', 'alakazam', "unikn", 
               'plotly', 'ggdendro', "RColorBrewer", install = F)
```

```{r}
source("functions.R")
```

## Sequence pre-processing

Summary statistics for each of the functional groups declared in the app.

The app includes the P1 and P11 naive datasets and the P4 non-naive dataset.

For P1 and P11 the following filtration criteria were applied:

* Functional sequence, no stop codons or frame shifts.
* Sequences which start from position 1 of the V gene.
* Sequences which didn't have gaps open (-) and didn't include any N's
* After changing into group annotations, sequences which had more than a single assignment in naive repertoires were remove.

The groups were created with similarity of 95% based on complete linkage and functional sequences and up to position 318.

## Projects sequence depth

```{r}
load("data_frac_new2.rda")

data <- data_frac$IGH$functional$nonsingle$all$`318`$complete$`95`

depth <- data %>% dplyr::group_by(project, subject) %>% dplyr::summarise(counts = sum(count))

ggplot(depth, aes(counts, fill = project)) + geom_histogram() + facet_grid(.~project) + 
  bbplot::bbc_style() + scale_color_manual(values = c("#1380A1", "#FAAB18", "#990000")) +
  theme(axis.text.x = element_text(size = 12, angle = 90), 
        axis.text.y = element_text(size = 14), legend.position = "none") #+
  	#scale_x_continuous(labels = scales::label_number(suffix = " K", scale = 1e-5)) # millions

```

